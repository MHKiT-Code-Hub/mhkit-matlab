var sourceData18 = {"FileName":"/Users/asimms/Desktop/Programming/mhkit_matlab_simms_dev/MHKiT-MATLAB/mhkit/dolfyn/rotate/earth2principal.m","RawFileContents":["function ds = earth2principal(advo,reverse)","%     Rotate data in an ADV dataset to/from principal axes. Principal","%     heading must be within the dataset.","%","%     All data in the advo.attrs['rotate_vars'] list will be","%     rotated by the principal heading, and also if the data objet has an","%     orientation matrix (orientmat) it will be rotated so that it","%     represents the orientation of the ADV in the principal","%     (reverse:earth) frame.","%","%     Parameters","%     ----------","%     advo : The adv object containing the data.","%     reverse : bool (default: False)","%            If True, this function performs the inverse rotation","%            (principal->earth).","%","","% This is in degrees CW from North","ang = deg2rad(90 - advo.attrs.principal_heading);","% convert this to radians CCW from east (which is expected by","% the rest of the function)","","if reverse","    cs_now = 'principal';","    cs_new = 'earth';","else","    ang = -1 * ang;","    cs_now = 'earth';","    cs_new = 'principal';","end","","cs = lower(advo.coord_sys);","if strcmp(cs,cs_new)","    fprintf('Data is already in the %s coordinate system', cs)","    ds = advo;","    return;","elseif ~strcmp(cs, cs_now)","    msgtext = [\"Data must be in the '%s' frame when using this \"...","        \"function.\", cs_now];","    ME = MException('MATLAB:dolfyn:earth2principal',msgtext);","    throwAsCaller(ME)","end","","ds = advo;","","% Calculate the rotation matrix:","cp = cos(ang);","sp = sin(ang);","rotmat = [cp, -sp, 0; sp, cp, 0; 0, 0, 1];","","% Perform the rotation:","if isfield(advo.attrs, 'rotate_vars')","    rotate_vars = advo.attrs.rotate_vars;","else","    rotate_vars = {'vel'};","end","","for qq = 1:numel(rotate_vars)","    nm = rotate_vars{qq};","    shape = size(advo.(nm).data);","    l = length(shape);","    otherdims = repmat({':'},1,l-1);","    if l == 4","        sumstr = 'da,cba->cbd';","    elseif l == 3","        sumstr = 'da,ca->cd';","    end","    rot = tensorproduct(rotmat(1:2,1:2),...","        squeeze(advo.(nm).data(otherdims{:},1:2)),sumstr);","    shape(end) = 2;","    ds.(nm).data(otherdims{:},1:2) = reshape(rot,shape);","end","","ds = set_coords(ds, cs_new);","ds.coord_sys = cs_new;","ds.attrs.coord_sys = cs_new;","","end","",""],"CoverageDisplayDataPerLine":{"Function":{"LineNumber":1,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":43,"ContinuedLine":false},"Statement":[{"LineNumber":20,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":49,"ContinuedLine":false},{"LineNumber":24,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":10,"ContinuedLine":false},{"LineNumber":25,"Hits":1,"StartColumnNumbers":4,"EndColumnNumbers":25,"ContinuedLine":false},{"LineNumber":26,"Hits":1,"StartColumnNumbers":4,"EndColumnNumbers":21,"ContinuedLine":false},{"LineNumber":28,"Hits":6,"StartColumnNumbers":4,"EndColumnNumbers":19,"ContinuedLine":false},{"LineNumber":29,"Hits":6,"StartColumnNumbers":4,"EndColumnNumbers":21,"ContinuedLine":false},{"LineNumber":30,"Hits":6,"StartColumnNumbers":4,"EndColumnNumbers":25,"ContinuedLine":false},{"LineNumber":33,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":27,"ContinuedLine":false},{"LineNumber":34,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":20,"ContinuedLine":false},{"LineNumber":35,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":62,"ContinuedLine":false},{"LineNumber":36,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":14,"ContinuedLine":false},{"LineNumber":37,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":11,"ContinuedLine":false},{"LineNumber":38,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":26,"ContinuedLine":false},{"LineNumber":39,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":64,"ContinuedLine":false},{"LineNumber":40,"Hits":0,"StartColumnNumbers":8,"EndColumnNumbers":29,"ContinuedLine":true},{"LineNumber":41,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":61,"ContinuedLine":false},{"LineNumber":42,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":21,"ContinuedLine":false},{"LineNumber":45,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":10,"ContinuedLine":false},{"LineNumber":48,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":14,"ContinuedLine":false},{"LineNumber":49,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":14,"ContinuedLine":false},{"LineNumber":50,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":42,"ContinuedLine":false},{"LineNumber":53,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":37,"ContinuedLine":false},{"LineNumber":54,"Hits":7,"StartColumnNumbers":4,"EndColumnNumbers":41,"ContinuedLine":false},{"LineNumber":56,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":26,"ContinuedLine":false},{"LineNumber":59,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":29,"ContinuedLine":false},{"LineNumber":60,"Hits":14,"StartColumnNumbers":4,"EndColumnNumbers":25,"ContinuedLine":false},{"LineNumber":61,"Hits":14,"StartColumnNumbers":4,"EndColumnNumbers":33,"ContinuedLine":false},{"LineNumber":62,"Hits":14,"StartColumnNumbers":4,"EndColumnNumbers":22,"ContinuedLine":false},{"LineNumber":63,"Hits":14,"StartColumnNumbers":4,"EndColumnNumbers":36,"ContinuedLine":false},{"LineNumber":64,"Hits":14,"StartColumnNumbers":4,"EndColumnNumbers":13,"ContinuedLine":false},{"LineNumber":65,"Hits":3,"StartColumnNumbers":8,"EndColumnNumbers":31,"ContinuedLine":false},{"LineNumber":66,"Hits":11,"StartColumnNumbers":4,"EndColumnNumbers":17,"ContinuedLine":false},{"LineNumber":67,"Hits":11,"StartColumnNumbers":8,"EndColumnNumbers":29,"ContinuedLine":false},{"LineNumber":69,"Hits":14,"StartColumnNumbers":4,"EndColumnNumbers":39,"ContinuedLine":false},{"LineNumber":70,"Hits":14,"StartColumnNumbers":8,"EndColumnNumbers":58,"ContinuedLine":true},{"LineNumber":71,"Hits":14,"StartColumnNumbers":4,"EndColumnNumbers":19,"ContinuedLine":false},{"LineNumber":72,"Hits":14,"StartColumnNumbers":4,"EndColumnNumbers":56,"ContinuedLine":false},{"LineNumber":75,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":28,"ContinuedLine":false},{"LineNumber":76,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":22,"ContinuedLine":false},{"LineNumber":77,"Hits":7,"StartColumnNumbers":0,"EndColumnNumbers":28,"ContinuedLine":false}]}}