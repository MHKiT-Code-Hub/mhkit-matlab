var sourceData13 = {"FileName":"/Users/asimms/Desktop/Programming/mhkit_matlab_simms_dev/MHKiT-MATLAB-2/mhkit/dolfyn/rotate/beam2inst.m","RawFileContents":["function ds = beam2inst(dat,reverse,rmod)","% Rotate velocities from beam to instrument coordinates.","%","%    Parameters","%    ----------","%    dat : The adv object containing the data.","%        The ADCP dataset","%    reverse : bool","%        If True, this function performs the inverse rotation (inst->beam).","%    rmod: string","%        awac, vector, signature, rdi","%__________________________________________________________________________","","% There are two paths depending on the make of the data","if strcmpi(rmod,'vector')","    % Order of rotations matters","    % beam->head(ADV instrument head)->inst(ADV battery case|imu)","    if reverse","        % First rotate velocities from ADV inst frame back to head frame","        dat = inst2head(dat, reverse);","        % Now rotate from the head frame to the beam frame","        ds = rotate(dat, reverse);","","    % inst(ADV battery case|imu)->head(ADV instrument head)->beam","    else","        % First rotate velocities from beam to ADV head frame","        dat = rotate(dat, reverse);","        % Then rotate from ADV head frame to ADV inst frame","        ds = inst2head(dat, reverse);","    end","else","    ds = rotate(dat, reverse);","end","%__________________________________________________________________________","","    function data = rotate(advo,reverse)","","        if reverse && ~strcmpi(advo.coord_sys, 'inst')","            msgtext = ['The input must be in inst coordinates.'];","            ME = MException('MATLAB:dolfyn:rotate:beam2inst',msgtext);","            throwAsCaller(ME)","        end","        if ~reverse && ~strcmpi(advo.coord_sys, 'beam')","            msgtext = ['The input must be in beam coordinates.'];","            ME = MException('MATLAB:dolfyn:rotate:beam2inst',msgtext);","            throwAsCaller(ME)","        end","","        if ~isfield(advo, 'beam2inst_orientmat')","            msgtext = ['Data set is missing the beam2inst orientation ' ...","                'matrix'];","            ME = MException('MATLAB:dolfyn:rotate:beam2inst',msgtext);","            throwAsCaller(ME)","        end","        rotmat = advo.beam2inst_orientmat.data;","","        cs = 'inst';","        if reverse","            % Can't use transpose because rotation is not between","            % orthogonal coordinate systems","            rotmat = inv(rotmat);","            cs = 'beam';","        end","","        for qq = 1:numel(advo.attrs.rotate_vars)","            nm = advo.attrs.rotate_vars{qq};","            if startsWith(nm, 'vel')","                if length(size(advo.(nm).data)) == 3","                    advo.(nm).data = tensorproduct(...","                        rotmat,advo.(nm).data, 'ab,cda->cdb');","                else","                    advo.(nm).data = tensorproduct(...","                        rotmat,advo.(nm).data, 'ab,cdea->cdeb');","                end","            end","        end","","        data = set_coords(advo, cs);","    end","","end","",""],"CoverageDisplayDataPerLine":{"Function":[{"LineNumber":1,"Hits":14,"StartColumnNumbers":0,"EndColumnNumbers":41,"ContinuedLine":false},{"LineNumber":36,"Hits":14,"StartColumnNumbers":4,"EndColumnNumbers":40,"ContinuedLine":false}],"Statement":[{"LineNumber":15,"Hits":14,"StartColumnNumbers":0,"EndColumnNumbers":25,"ContinuedLine":false},{"LineNumber":18,"Hits":4,"StartColumnNumbers":4,"EndColumnNumbers":14,"ContinuedLine":false},{"LineNumber":20,"Hits":2,"StartColumnNumbers":8,"EndColumnNumbers":38,"ContinuedLine":false},{"LineNumber":22,"Hits":2,"StartColumnNumbers":8,"EndColumnNumbers":34,"ContinuedLine":false},{"LineNumber":27,"Hits":2,"StartColumnNumbers":8,"EndColumnNumbers":35,"ContinuedLine":false},{"LineNumber":29,"Hits":2,"StartColumnNumbers":8,"EndColumnNumbers":37,"ContinuedLine":false},{"LineNumber":32,"Hits":10,"StartColumnNumbers":4,"EndColumnNumbers":30,"ContinuedLine":false},{"LineNumber":38,"Hits":14,"StartColumnNumbers":8,"EndColumnNumbers":54,"ContinuedLine":false},{"LineNumber":39,"Hits":0,"StartColumnNumbers":12,"EndColumnNumbers":65,"ContinuedLine":false},{"LineNumber":40,"Hits":0,"StartColumnNumbers":12,"EndColumnNumbers":70,"ContinuedLine":false},{"LineNumber":41,"Hits":0,"StartColumnNumbers":12,"EndColumnNumbers":29,"ContinuedLine":false},{"LineNumber":43,"Hits":14,"StartColumnNumbers":8,"EndColumnNumbers":55,"ContinuedLine":false},{"LineNumber":44,"Hits":0,"StartColumnNumbers":12,"EndColumnNumbers":65,"ContinuedLine":false},{"LineNumber":45,"Hits":0,"StartColumnNumbers":12,"EndColumnNumbers":70,"ContinuedLine":false},{"LineNumber":46,"Hits":0,"StartColumnNumbers":12,"EndColumnNumbers":29,"ContinuedLine":false},{"LineNumber":49,"Hits":14,"StartColumnNumbers":8,"EndColumnNumbers":48,"ContinuedLine":false},{"LineNumber":50,"Hits":0,"StartColumnNumbers":12,"EndColumnNumbers":71,"ContinuedLine":false},{"LineNumber":51,"Hits":0,"StartColumnNumbers":16,"EndColumnNumbers":26,"ContinuedLine":true},{"LineNumber":52,"Hits":0,"StartColumnNumbers":12,"EndColumnNumbers":70,"ContinuedLine":false},{"LineNumber":53,"Hits":0,"StartColumnNumbers":12,"EndColumnNumbers":29,"ContinuedLine":false},{"LineNumber":55,"Hits":14,"StartColumnNumbers":8,"EndColumnNumbers":47,"ContinuedLine":false},{"LineNumber":57,"Hits":14,"StartColumnNumbers":8,"EndColumnNumbers":20,"ContinuedLine":false},{"LineNumber":58,"Hits":14,"StartColumnNumbers":8,"EndColumnNumbers":18,"ContinuedLine":false},{"LineNumber":61,"Hits":7,"StartColumnNumbers":12,"EndColumnNumbers":33,"ContinuedLine":false},{"LineNumber":62,"Hits":7,"StartColumnNumbers":12,"EndColumnNumbers":24,"ContinuedLine":false},{"LineNumber":65,"Hits":14,"StartColumnNumbers":8,"EndColumnNumbers":48,"ContinuedLine":false},{"LineNumber":66,"Hits":59,"StartColumnNumbers":12,"EndColumnNumbers":44,"ContinuedLine":false},{"LineNumber":67,"Hits":59,"StartColumnNumbers":12,"EndColumnNumbers":36,"ContinuedLine":false},{"LineNumber":68,"Hits":15,"StartColumnNumbers":16,"EndColumnNumbers":52,"ContinuedLine":false},{"LineNumber":69,"Hits":5,"StartColumnNumbers":20,"EndColumnNumbers":51,"ContinuedLine":false},{"LineNumber":70,"Hits":5,"StartColumnNumbers":24,"EndColumnNumbers":62,"ContinuedLine":true},{"LineNumber":72,"Hits":10,"StartColumnNumbers":20,"EndColumnNumbers":51,"ContinuedLine":false},{"LineNumber":73,"Hits":10,"StartColumnNumbers":24,"EndColumnNumbers":64,"ContinuedLine":true},{"LineNumber":78,"Hits":14,"StartColumnNumbers":8,"EndColumnNumbers":36,"ContinuedLine":false}]}}