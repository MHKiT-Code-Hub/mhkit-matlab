var sourceData56 = {"FileName":"/Users/asimms/Desktop/Programming/mhkit_matlab_simms_dev/MHKiT-MATLAB/mhkit/power/quality/flicker_ufic_workflow.m","RawFileContents":["function out = flicker_ufic_workflow(Sr,Un,SCR,fg, ...\r","        u_m,i_m,method,methodopts)\r","\r","%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\r","%   Conduct flicker assessment according to IECTS62600-30 and\r","%   IECTS61400-21-1.\r","%   A workflow of MATLAB functions up to calculation of u_fic.\r","%\r","% Parameters\r","% -----------\r","%   Sr: double\r","%       Rated apparent power of the marine energy converter (VA).\r","%   Un: double\r","%       RMS value of the nomianal voltage of the grid (V).\r","%   SCR: double\r","%       Short-circuit ratio, SCR = S_kfic/Sr\r","%   fg: double\r","%       Nominal grid frequency, 60Hz or 50Hz\r","%   u_m: struct()\r","%       u_m(t) is the measured instantaneous voltage (V)\r","%       .time: time at each measurement (s)\r","%       .data: array of size (ntime) measured instantaneous voltage (V).\r","%   i_m: struct()\r","%       i_m(t) is the measured instantaneous current (A)\r","%       .time: time at each measurement\r","%       .data: array of size (ntime, 4) measured instantaneous current (A)\r","%       at impedance phase angles = 30, 50, 70, 85.\r","%   method: string\r","%       Method used to calculate fundamental frequency of u_m, 'zcd' or\r","%       'stft'\r","%   methodopts: cell array\r","%       Name-value arguments for STFT method, if using 'ZCD' method, can\r","%       set to {}.\r","%\r","% Returns\r","% [Lfic,Rfic,alpha0,freq,alpha_m,u0,u_fic]\r","% -------\r","%   out: struct()\r","%        output a MATLAB struct() that contains u_fic and all the\r","%        intermediate variables, including:\r","%       .Lfic: double array (4)\r","%           fictitious grid inductance (H) for Phi_k = 30, 50, 70, 85.\r","%       .Rfic: double array (4)\r","%           fictitious grid resistance (Ohm) for Phi_k = 30, 50, 70, 85.\r","%       .alpha0: double\r","%           Electrical angle (radians) at t=0.\r","%       .freq: struct()\r","%           .time: time at each measurement time step (s)\r","%           .data: double array of size (ntime), freq(t), the fundamental\r","%           frequency calculated for u_m(t).\r","%       .alpha_m: double array (ntime)\r","%           Electrical angle (alpha_m(t)) of the fundamental component of\r","%           u_m(t)\r","%       .u0: double array (ntime)\r","%           Ideal phase-to-neutral voltage source u0(t) (V)\r","%       .u_fic: double array (ntime,4)\r","%           Instantaneous phase-to-neutral voltage simulated at fictitious\r","%           grid (V) for impedence angles = 30, 50, 70, 85\r","% Note\r","% -------\r","% Step 1. Construct the fictitious grid by calculating Rfic and Lfic.\r","%       [Rfic,Lfic]=calc_Rfic_Lfic(Sr,SCR,Un,fg)\r","%\r","% Step 2. Calculate ideal voltahe source (u0) from measured voltage (u_m).\r","%   Step 2.1 Calculate the fundamental frequency and alpha_0 of u_m\r","%       [alpha0,freq] = calc_fundamental_freq(u_m,method,methodopts)\r","%   Step 2.2 Calculate the electrical angle (alpha_m)\r","%       alpha_m = calc_electrical_angle(freq,alpha0)\r","%   Step 2.3 Calculate the ideal voltage (u0)\r","%       u0=calc_ideal_voltage(Un,alpha_m)\r","%\r","% Step 3. Calculate simulated voltage (u_fic) for the fictitious grid\r","%       u_fic=calc_simulated_voltage(u0,i_m,Rfic,Lfic)\r","%\r","%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\r","\r","% check input:\r","if ~isfield(u_m,'time') || ~isfield(u_m, 'data') ||...\r","        ~isfield(i_m,'time') || ~isfield(i_m, 'data')\r","    ME = MException('MATLAB:flicker_ufic',...\r","        'invalid handles in structure, must contain x.data & x.time');\r","    throw(ME);\r","end\r","%% Step 1. Construct the fictitious grid:\r","[Rfic,Lfic] = calc_Rfic_Lfic(Sr, SCR, Un, fg);\r","%% Step 2. Calculate ideal voltage (u0) from measured voltage (u_m)\r","%% Step 2.1 Calculate the fundamental frequency and alpha_0:\r","%   -opt1: method ZCD: method = 'ZCD'; methodopts={};\r","%   -opt2: method STFT: method = 'stft'; methodopts = {'Window',rectwin(M),...\r","%           'OverlapLength',L,'FFTLength',128,'FrequencyRange','onesided'};\r","[alpha0,freq] = calc_fundamental_freq(u_m,method,methodopts);\r","%% Step 2.2 Calculate the electrical angle (alpha_m):\r","alpha_m = calc_electrical_angle(freq,alpha0);\r","%% Step 2.3 Calculate ideal voltage (u0):\r","u0 = calc_ideal_voltage(Un,alpha_m);\r","%% Step 3. Calculate simulated voltage (u_fic)\r","u_fic = calc_simulated_voltage(u0,i_m,Rfic,Lfic);\r","%% construct output:\r","out = struct();out.time = u_m.time;\r","out.Rfic = Rfic; out.Lfic = Lfic;\r","out.alpha0 = alpha0; out.freq=freq;\r","out.alpha_m = alpha_m;\r","out.u0 = u0;\r","out.u_fic = u_fic;\r","end\r","\r",""],"CoverageDisplayDataPerLine":{"Function":[{"LineNumber":1,"Hits":2,"StartColumnNumbers":0,"EndColumnNumbers":54,"ContinuedLine":false},{"LineNumber":2,"Hits":2,"StartColumnNumbers":8,"EndColumnNumbers":34,"ContinuedLine":true}],"Statement":[{"LineNumber":78,"Hits":2,"StartColumnNumbers":0,"EndColumnNumbers":50,"ContinuedLine":false},{"LineNumber":79,"Hits":2,"StartColumnNumbers":8,"EndColumnNumbers":53,"ContinuedLine":true},{"LineNumber":80,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":41,"ContinuedLine":false},{"LineNumber":81,"Hits":0,"StartColumnNumbers":8,"EndColumnNumbers":70,"ContinuedLine":true},{"LineNumber":82,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":14,"ContinuedLine":false},{"LineNumber":85,"Hits":2,"StartColumnNumbers":0,"EndColumnNumbers":46,"ContinuedLine":false},{"LineNumber":91,"Hits":2,"StartColumnNumbers":0,"EndColumnNumbers":61,"ContinuedLine":false},{"LineNumber":93,"Hits":2,"StartColumnNumbers":0,"EndColumnNumbers":45,"ContinuedLine":false},{"LineNumber":95,"Hits":2,"StartColumnNumbers":0,"EndColumnNumbers":36,"ContinuedLine":false},{"LineNumber":97,"Hits":2,"StartColumnNumbers":0,"EndColumnNumbers":49,"ContinuedLine":false},{"LineNumber":99,"Hits":[2,2],"StartColumnNumbers":[0,15],"EndColumnNumbers":[15,35],"ContinuedLine":false},{"LineNumber":100,"Hits":[2,2],"StartColumnNumbers":[0,17],"EndColumnNumbers":[16,33],"ContinuedLine":false},{"LineNumber":101,"Hits":[2,2],"StartColumnNumbers":[0,21],"EndColumnNumbers":[20,35],"ContinuedLine":false},{"LineNumber":102,"Hits":2,"StartColumnNumbers":0,"EndColumnNumbers":22,"ContinuedLine":false},{"LineNumber":103,"Hits":2,"StartColumnNumbers":0,"EndColumnNumbers":12,"ContinuedLine":false},{"LineNumber":104,"Hits":2,"StartColumnNumbers":0,"EndColumnNumbers":18,"ContinuedLine":false}]}}