<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2023a"><title>Example: MHKiT-MATLAB Tidal Module </title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(192, 76, 11); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S2 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F5F5F5; margin: 10px 0 10px 0; }
.S3 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 1px solid rgb(217, 217, 217); border-bottom: 0px none rgb(33, 33, 33); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S4 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S5 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 1px solid rgb(217, 217, 217); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S6 { margin: 10px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span>Example: MHKiT-MATLAB Tidal Module </span></h1><div  class = 'S1'><span>The following example will familiarize the user with the</span><span> </span><a href = "https://mhkit-software.github.io/MHKiT/mhkit-matlab/api.tidal.html"><span style=' text-decoration: underline;'>MHKiT tidal module</span></a><span> </span><span>by stepping through the calculation of the velocity duration curve. The data file used in this example is stored in the</span><span> </span><a href = "https://github.com/MHKiT-Code-Hub/MHKiT-MATLAB/tree/master/examples/data"><span style=' text-decoration: underline;'>\MHKiT\examples\data</span></a><span> directory.</span></div><h2  class = 'S2'><span>Load Data from NOAA-Currents </span></h2><div  class = 'S1'><span>This example uses 1 year of data from the NOAA-Currents sites. A map of available currents stations is available at</span><span> </span><a href = "https://tidesandcurrents.noaa.gov/map/"><span style=' text-decoration: underline;'>https://tidesandcurrents.noaa.gov/map/</span></a><span>. The tidal io module includes two functions to import data:</span><span> </span><span style=' font-family: monospace;'>request_noaa_data</span><span> </span><span>which pulls data from the website, and</span><span> </span><span style=' font-family: monospace;'>read_noaa_json</span><span> </span><span>which loads a json file. The request function can save the json file for later use.</span><span> </span></div><div  class = 'S1'><span>For simplicity, this example loads data from a json file into a MATLAB Series. This data contains 1 year of 6-minute averaged data from the Southampton Shoal Channel LB 6 (Station Number: s08010) in San Francisco Bay. The data includes 6-minute averaged direction [degrees] and speed [cm/s] indexed by time. The structure names returned by NOAA are 'd' for direction and 's' for speed. Since MHKIT uses SI units, speed is converted to m/s.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Create a file name to save the requested data to</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >relative_file_name = </span><span style="color: rgb(167, 9, 245);">"data/tidal/s08010.json"</span><span >; </span><span style="color: rgb(0, 128, 19);">% South Hampton Shoal LB</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >current_dir = fileparts(matlab.desktop.editor.getActiveFilename);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >full_file_name = fullfile(current_dir, relative_file_name);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >data = read_noaa_json(full_file_name)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Example of how you could request NOAA-Currents data</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%data = request_noaa_data("s08010","currents","20161101","20180401","write_json",currents_file);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Convert discharge data from cm/s to m/s</span></span></div></div><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >data.s = data.s/100.; </span></span></div></div></div><div  class = 'S6'><span>The request_noaa_data has returned a Matlab Structure of time series data between November of 2016 and March of 2018. The time series data points are 6-minute averaged direction [degrees] and speed [cm/s] data indexed by time. The structure key names returned by NOAA are 'd' for direction and 's' for speed. The speed returned from NOAA is in cm/s so we converted this to m/s.</span></div><h2  class = 'S2'><span>Principal Flow Directions</span></h2><div  class = 'S1'><span>An initial data check may look at the time series data to identify data gaps. To consider the velocity in one of the principal flow directions we apply the</span><span> </span><span style=' font-family: monospace;'>principal_flow_directions</span><span> </span><span>function. This function returns 2 directions (in degrees) corresponding to the flood and ebb directions of the tidal site. Principal flow directions are calculated based on the highest frequency directions. These directions are often close to 180 degrees apart, but are not required to be.</span></div><div  class = 'S1'><span>The</span><span> </span><span style=' font-family: monospace;'>plot_current_timeseries</span><span> </span><span>function plots velocity in either direction using the speed timeseries.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% We need to specify a histogram bin width for the directions to calculate</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% the principal flow direction </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >width_direction = 1; </span><span style="color: rgb(0, 128, 19);">% [degrees]</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Two principal directions are calculated based on the highest frequency</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% direction </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% One direction is the flood, the other is tide or ebb. </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% they are 180 degrees apart, but not required to be </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >[direction1, direction2] = principal_flow_directions(data.d,width_direction);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Set the flood and ebb directions based on site knowledge</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >flood = direction1 ; </span><span style="color: rgb(0, 128, 19);">%flow into</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >ebb = direction2 ; </span><span style="color: rgb(0, 128, 19);">% flow out</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%plot the time series of current data using the flood direction </span></span></div></div><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >plot_current_timeseries(data,flood);</span></span></div></div></div><div  class = 'S6'><span>The plot above shows that the NOAA site request did not return data for most of early and mid-2017. The IEC standard recommends a minimum of 1 year of 10-minute averaged data (See IEC 201 for full description). For the purposes of demonstration this dataset is sufficient. To look at a specific month we can slice the dataset before passing to the plotting function.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Slice December of 2017 out of the full dataset </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >start = posixtime(datetime(</span><span style="color: rgb(167, 9, 245);">'2017-12-01'</span><span >,</span><span style="color: rgb(167, 9, 245);">'InputFormat'</span><span >,</span><span style="color: rgb(167, 9, 245);">'yyyy-MM-dd'</span><span >));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >stop = posixtime(datetime(</span><span style="color: rgb(167, 9, 245);">'2017-12-31'</span><span >,</span><span style="color: rgb(167, 9, 245);">'InputFormat'</span><span >,</span><span style="color: rgb(167, 9, 245);">'yyyy-MM-dd'</span><span >));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >index = data.time &gt; start &amp; data.time &lt; stop ; </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >datadec.time = data.time(index);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >datadec.s = data.s(index);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >datadec.d = data.d(index);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >plot_current_timeseries(datadec,flood);</span></span></div></div></div><h2  class = 'S2'><span>Joint Probability Distribution </span></h2><div  class = 'S1'><span>Direction and velocity can be viewed as a joint probability distribution on a polar plot. This plot helps visually show the flood and ebb directions and the frequency of particular directional velocities.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Set the joint probability bit widths </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >width_direction = 1 ;  </span><span style="color: rgb(0, 128, 19);">%[degrees]</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >width_velocity  = 0.1 ; </span><span style="color: rgb(0, 128, 19);">%[m/s]</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Plot the joint probability distribution</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >figure;</span></span></div></div><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >plot_joint_probability_distribution(data,width_direction,width_velocity);</span></span></div></div></div><h2  class = 'S2'><span>Rose Plot</span></h2><div  class = 'S1'><span>A rose plot shows the same information as the joint probability distribution, but the probability is now the r-axis, and the velocity is the contour value. As compared to a joint probability distribution plot, a rose plot can be more readable when using larger bins sizes.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% A rose plot is more readable using larger bin sizes than the jpd plot</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >width_direction = 10; </span><span style="color: rgb(0, 128, 19);">% [degrees]</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >width_velocity = 0.25; </span><span style="color: rgb(0, 128, 19);">%[m/s]</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%plot the rose plot</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">%f2= figure;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >figure;</span></span></div></div><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >plot_rose(data,width_direction,width_velocity,</span><span style="color: rgb(167, 9, 245);">"flood_ebb"</span><span >,[flood,ebb]); </span></span></div></div></div><h2  class = 'S2'><span>Velocity Duration Curve</span></h2><div  class = 'S1'><span>The velocity duration curve shows the probability of achieving a particular velocity value. After computing the exceedance probability, the rank order of velocity values can be plotted as follows.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Calculate the exceedance probability of the data</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >data.Discharge = data.s; </span><span style="color: rgb(0, 128, 19);">% need to change structure name for exceedance probability function</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >F = exceedance_probability(data);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Plot the VDC</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >plot_velocity_duration_curve(data.s,F.F);</span></span></div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% Example: MHKiT-MATLAB Tidal Module 
% The following example will familiarize the user with the <https://mhkit-software.github.io/MHKiT/mhkit-matlab/api.tidal.html 
% MHKiT tidal module> by stepping through the calculation of the velocity duration 
% curve. The data file used in this example is stored in the <https://github.com/MHKiT-Code-Hub/MHKiT-MATLAB/tree/master/examples/data 
% \MHKiT\examples\data> directory.
%% Load Data from NOAA-Currents 
% This example uses 1 year of data from the NOAA-Currents sites. A map of available 
% currents stations is available at <https://tidesandcurrents.noaa.gov/map/ https://tidesandcurrents.noaa.gov/map/>. 
% The tidal io module includes two functions to import data: |request_noaa_data| 
% which pulls data from the website, and |read_noaa_json| which loads a json file. 
% The request function can save the json file for later use. 
% 
% For simplicity, this example loads data from a json file into a MATLAB Series. 
% This data contains 1 year of 6-minute averaged data from the Southampton Shoal 
% Channel LB 6 (Station Number: s08010) in San Francisco Bay. The data includes 
% 6-minute averaged direction [degrees] and speed [cm/s] indexed by time. The 
% structure names returned by NOAA are 'd' for direction and 's' for speed. Since 
% MHKIT uses SI units, speed is converted to m/s.

% Create a file name to save the requested data to
relative_file_name = "data/tidal/s08010.json"; % South Hampton Shoal LB
current_dir = fileparts(matlab.desktop.editor.getActiveFilename);
full_file_name = fullfile(current_dir, relative_file_name);

data = read_noaa_json(full_file_name)
% Example of how you could request NOAA-Currents data
%data = request_noaa_data("s08010","currents","20161101","20180401","write_json",currents_file);


% Convert discharge data from cm/s to m/s
data.s = data.s/100.; 
%% 
% The request_noaa_data has returned a Matlab Structure of time series data 
% between November of 2016 and March of 2018. The time series data points are 
% 6-minute averaged direction [degrees] and speed [cm/s] data indexed by time. 
% The structure key names returned by NOAA are 'd' for direction and 's' for speed. 
% The speed returned from NOAA is in cm/s so we converted this to m/s.
%% Principal Flow Directions
% An initial data check may look at the time series data to identify data gaps. 
% To consider the velocity in one of the principal flow directions we apply the 
% |principal_flow_directions| function. This function returns 2 directions (in 
% degrees) corresponding to the flood and ebb directions of the tidal site. Principal 
% flow directions are calculated based on the highest frequency directions. These 
% directions are often close to 180 degrees apart, but are not required to be.
% 
% The |plot_current_timeseries| function plots velocity in either direction 
% using the speed timeseries.

% We need to specify a histogram bin width for the directions to calculate
% the principal flow direction 
width_direction = 1; % [degrees]

% Two principal directions are calculated based on the highest frequency
% direction 
% One direction is the flood, the other is tide or ebb. 
% they are 180 degrees apart, but not required to be 
[direction1, direction2] = principal_flow_directions(data.d,width_direction);

% Set the flood and ebb directions based on site knowledge
flood = direction1 ; %flow into
ebb = direction2 ; % flow out


%plot the time series of current data using the flood direction 
plot_current_timeseries(data,flood);
%% 
% The plot above shows that the NOAA site request did not return data for most 
% of early and mid-2017. The IEC standard recommends a minimum of 1 year of 10-minute 
% averaged data (See IEC 201 for full description). For the purposes of demonstration 
% this dataset is sufficient. To look at a specific month we can slice the dataset 
% before passing to the plotting function.

% Slice December of 2017 out of the full dataset 
start = posixtime(datetime('2017-12-01','InputFormat','yyyy-MM-dd'));
stop = posixtime(datetime('2017-12-31','InputFormat','yyyy-MM-dd'));
index = data.time > start & data.time < stop ; 
datadec.time = data.time(index);
datadec.s = data.s(index);
datadec.d = data.d(index);

plot_current_timeseries(datadec,flood);
%% Joint Probability Distribution 
% Direction and velocity can be viewed as a joint probability distribution on 
% a polar plot. This plot helps visually show the flood and ebb directions and 
% the frequency of particular directional velocities.

% Set the joint probability bit widths 
width_direction = 1 ;  %[degrees]
width_velocity  = 0.1 ; %[m/s]

% Plot the joint probability distribution
figure;
plot_joint_probability_distribution(data,width_direction,width_velocity);
%% Rose Plot
% A rose plot shows the same information as the joint probability distribution, 
% but the probability is now the r-axis, and the velocity is the contour value. 
% As compared to a joint probability distribution plot, a rose plot can be more 
% readable when using larger bins sizes.

% A rose plot is more readable using larger bin sizes than the jpd plot
width_direction = 10; % [degrees]
width_velocity = 0.25; %[m/s]

%plot the rose plot
%f2= figure;
figure;
plot_rose(data,width_direction,width_velocity,"flood_ebb",[flood,ebb]); 
%% Velocity Duration Curve
% The velocity duration curve shows the probability of achieving a particular 
% velocity value. After computing the exceedance probability, the rank order of 
% velocity values can be plotted as follows.

% Calculate the exceedance probability of the data
data.Discharge = data.s; % need to change structure name for exceedance probability function
F = exceedance_probability(data);

% Plot the VDC

plot_velocity_duration_curve(data.s,F.F);
##### SOURCE END #####
-->
</div></body></html>